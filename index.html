<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>台灣綜合所得稅試算 (2024年度)</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
:root {
    --md-primary: #6750A4;
    --md-on-primary: #FFFFFF;
    --md-surface: #FFFFFF;
    --md-background: #FFFBFE;
    --md-outline: #79747E;
}
body {
    font-family: 'Noto Sans TC', sans-serif;
    margin: 24px;
    background: var(--md-background);
}
.container {
    max-width: 700px;
    margin: auto;
    background: var(--md-surface);
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
h1 { text-align: center; margin-bottom: 16px; }
label { display: block; margin-top: 16px; font-weight: 700; }
input[type="number"], select {
    width: 100%;
    padding: 12px;
    margin-top: 4px;
    border: 1px solid var(--md-outline);
    border-radius: 4px;
    background: var(--md-surface);
}
button {
    margin-top: 24px;
    padding: 10px 24px;
    background-color: var(--md-primary);
    color: var(--md-on-primary);
    border: none;
    border-radius: 20px;
    cursor: pointer;
}
button:hover { background-color: #57408C; }
.result {
    margin-top: 24px;
    font-size: 1.2em;
    font-weight: bold;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
}
th, td {
    padding: 8px 12px;
    border-bottom: 1px solid #ccc;
    text-align: center;
}
</style>
</head>
<body>
<div class="container">
<h1>2024 年綜合所得稅試算</h1>
<p>此工具僅供參考，使用 2024 年度（2025/05 繳稅）預估之稅率與免稅額資料。實際稅額以財政部公告為準。</p>
<h2>計算方式簡介</h2>
<p>先以 <strong>綜合所得總額</strong> 扣除 <strong>免稅額</strong> 與 <strong>標準扣除額</strong>，得到應納稅額。</p>
<p>依下列級距計算稅額：</p>
<table>
    <thead>
        <tr><th>級距</th><th>稅率</th></tr>
    </thead>
    <tbody>
        <tr><td>0 ～ 560,000 元</td><td>5%</td></tr>
        <tr><td>560,001 ～ 1,260,000 元</td><td>12%</td></tr>
        <tr><td>1,260,001 ～ 2,520,000 元</td><td>20%</td></tr>
        <tr><td>2,520,001 ～ 4,720,000 元</td><td>30%</td></tr>
        <tr><td>4,720,001 元以上</td><td>40%</td></tr>
    </tbody>
</table>
<ul>
<li>免稅額（每人）：92,000 元</li>
<li>標準扣除額：單身 124,000 元，夫妻合併申報 248,000 元</li>
<li>此範例未考慮其他扣除額與各式減免</li>
</ul>
<h2>試算</h2>
<label for="income">綜合所得總額 (新台幣)：</label>
<input id="income" type="number" placeholder="請輸入年度綜合所得" />
<label for="dependents">申報人數 (含本人)：</label>
<input id="dependents" type="number" value="1" min="1" />
<label for="married">夫妻合併申報？</label>
<select id="married">
<option value="no">否</option>
<option value="yes">是</option>
</select>
<button onclick="calculate()">計算稅額</button>
<div class="result" id="result"></div>
<canvas id="taxChart" height="300"></canvas>
</div>
<script src="chart.umd.js"></script>
<script>
function calcTaxableIncome(total, people, married) {
    var exemption = 92000 * people;
    var standardDeduction = married ? 248000 : 124000;
    var taxable = total - exemption - standardDeduction;
    return taxable > 0 ? taxable : 0;
}

function calcTax(amount) {
    var brackets = [
        { threshold: 0, rate: 0.05, base: 0 },
        { threshold: 560000, rate: 0.12, base: 28000 },
        { threshold: 1260000, rate: 0.20, base: 112000 },
        { threshold: 2520000, rate: 0.30, base: 364000 },
        { threshold: 4720000, rate: 0.40, base: 1024000 }
    ];
    for (var i = brackets.length - 1; i >= 0; i--) {
        var b = brackets[i];
        if (amount > b.threshold) {
            return b.base + (amount - b.threshold) * b.rate;
        }
    }
    return 0;
}

function buildData(people, married) {
    var data = [];
    for (var i = 0; i <= 10000000; i += 10000) {
        var taxable = calcTaxableIncome(i, people, married);
        var tax = calcTax(taxable);
        data.push({ x: i, y: tax });
    }
    return data;
}

var taxChart;
var lineDataset = {
    label: '稅額',
    data: [],
    borderColor: 'blue',
    pointRadius: 0,
    fill: false,
    parsing: { xAxisKey: 'x', yAxisKey: 'y' }
};
var highlightDataset = {
    label: '輸入值',
    data: [],
    backgroundColor: 'red',
    pointRadius: 5,
    showLine: false,
    parsing: { xAxisKey: 'x', yAxisKey: 'y' }
};

const hoverLine = {
    id: 'hoverLine',
    afterDraw(chart) {
        var tooltip = chart.tooltip;
        if (tooltip && tooltip._active && tooltip._active.length) {
            var ctx = chart.ctx;
            var x = tooltip._active[0].element.x;
            var topY = chart.chartArea.top;
            var bottomY = chart.chartArea.bottom;
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(x, topY);
            ctx.lineTo(x, bottomY);
            ctx.strokeStyle = 'rgba(0,0,0,0.3)';
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.restore();
        }
    }
};

function initChart(people, married) {
    var ctx = document.getElementById('taxChart').getContext('2d');
    lineDataset.data = buildData(people, married);
    taxChart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [lineDataset, highlightDataset]
        },
        options: {
            interaction: { mode: 'index', intersect: false },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '收入: ' + context.parsed.x.toLocaleString() + ' 元\n稅額: ' + context.parsed.y.toLocaleString() + ' 元';
                        }
                    }
                },
                legend: { display: false }
            },
            scales: {
                x: { title: { display: true, text: '收入 (元)' }, min: 0, max: 10000000 },
                y: { title: { display: true, text: '稅額 (元)' } }
            }
        },
        plugins: [hoverLine]
    });
}

function updateChart(income, people, married) {
    lineDataset.data = buildData(people, married);
    if (income > 0) {
        var taxable = calcTaxableIncome(income, people, married);
        highlightDataset.data = [{ x: income, y: calcTax(taxable) }];
    } else {
        highlightDataset.data = [];
    }
    taxChart.update();
}

function calculate() {
    var income = parseFloat(document.getElementById('income').value || '0');
    var people = parseInt(document.getElementById('dependents').value || '1');
    var married = document.getElementById('married').value === 'yes';
    var taxable = calcTaxableIncome(income, people, married);
    var tax = calcTax(taxable);
    document.getElementById('result').textContent = '預估應納稅額：' + Math.round(tax).toLocaleString() + ' 元';
    updateChart(income, people, married);
}

window.addEventListener('DOMContentLoaded', function() {
    initChart(1, false);
});
</script>
</body>
</html>
